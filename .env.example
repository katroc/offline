### MCP Server
MCP_PORT=8787
MCP_HOST=127.0.0.1

### Document Sources Configuration
# Confluence (required for real RAG - leave empty to use mock data)
CONFLUENCE_BASE_URL=https://confluence.local
CONFLUENCE_USERNAME=service-account
CONFLUENCE_API_TOKEN=your-api-token-here

### LLM Configuration (Ollama or OpenAI-compatible)
# Set this to enable LLM answers; leave empty to use stubbed answers
LLM_BASE_URL=http://127.0.0.1:11434
LLM_CHAT_MODEL=openai/gpt-oss-20b
# Default to Gemma embedding model (available in your setup)
LLM_EMBED_MODEL=text-embedding-embeddinggemma-300m-qat

### Request timeouts
REQUEST_TIMEOUT_MS=15000

### Vector Database
# Choose vector store: 'lancedb' or 'chroma'
VECTOR_STORE=lancedb
# LanceDB (default)
LANCEDB_PATH=./data/lancedb
# Chroma (alternative)
CHROMA_HOST=localhost
CHROMA_PORT=8000
CHROMA_SSL=false
CHROMA_COLLECTION=confluence_chunks
CHROMA_AUTH_PROVIDER=
CHROMA_AUTH_CREDENTIALS=
# Common settings
CHUNK_TTL_DAYS=7
MIN_VECTOR_RESULTS=3
ADAPTIVE_THRESHOLD=false
# Optional lexical floor for vector results (0..1)
MIN_KEYWORD_SCORE=0.0

### Vector Retrieval Tuning (LanceDB)
# Index + ANN settings (best-effort; ignored if not supported by your LanceDB)
LANCEDB_USE_HNSW=true
LANCEDB_METRIC=cosine
LANCEDB_HNSW_M=16
LANCEDB_HNSW_EF_CONSTRUCTION=200
LANCEDB_EF_SEARCH=200
LANCEDB_NPROBES=64
LANCEDB_REFINE_FACTOR=2

# Candidate pool and MMR diversity
MAX_VECTOR_CANDIDATES=50
MMR_LAMBDA=0.7
MMR_POOL_MULTIPLIER=10

# Embedding enrichment
EMBED_INCLUDE_TITLE=true
EMBED_TITLE_WEIGHT=2
EMBED_INCLUDE_LABELS=false
EMBED_INCLUDE_ANCHOR=false

### Intent Processing
# Enable normalization + multi-variant retrieval
ENABLE_INTENT_PROCESSING=true
# Minimum confidence to prefer normalized form over original
INTENT_CONFIDENCE_THRESHOLD=0.7
# Max number of fallback query variants to attempt
MAX_FALLBACK_QUERIES=3
# Smart RAG relevance threshold (0.0-1.0) - higher = more strict
SMART_RAG_THRESHOLD=0.3
# Allow documents marked as "ANSWERS" to bypass the relevance threshold
SMART_RAG_ALLOW_ANSWERS_BYPASS=true

### Logging
LOG_LEVEL=info

### Admin
# Protect admin endpoints for sync/reindex
ADMIN_API_KEY=change-me

### Crawler / Ingestion (background)
# Comma-separated list of Confluence spaces to crawl (e.g., ENG,OPS,HR)
CRAWL_SPACES=
# Cron for periodic crawl (use standard 5-field cron or leave empty to disable)
# Example: every 15 minutes: */15 * * * *
CRAWL_CRON=
# Max pages per tick per space (pagination)
CRAWL_PAGE_SIZE=50
CRAWL_MAX_PAGES_PER_TICK=200
# Concurrency of page-level indexing (per process)
CRAWL_CONCURRENCY=4

# Rate limit and retries
# Confluence calls: minimum interval between requests (ms). 0 to disable pacing.
CONFLUENCE_MIN_INTERVAL_MS=150
# Embedding: batch size per request and optional delay between batches (ms)
EMBED_BATCH_SIZE=16
EMBED_DELAY_MS=0
# Embedding retry policy (for 429/5xx)
EMBED_MAX_RETRIES=3
EMBED_BACKOFF_BASE_MS=250
# LanceDB schema behavior
# If true, throw on schema mismatch; if false, silently drop unknown fields (e.g., url) and continue
LANCEDB_STRICT_SCHEMA=false
